# .github/workflows/release.yml no repositório consumidor
name: Release e Publicação Semântica

on:
  push:
    branches: [ main ] # Dispara após o merge em main
  workflow_dispatch:

jobs:
  release:
    name: Gerar Release e Tag
    uses: heliomarpm/ci-reusable/.github/workflows/node-release.yml@main
    with:
      branch_to_watch: 'main'
      simulate_release: false
    secrets:
      # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }} 

  publish:
    name: Publicar no NPM
    needs: release
    # Só publica se o release for bem-sucedido (tag criada)
    if: success()
    uses: heliomarpm/ci-reusable/.github/workflows/node-publish.yml@main
    with:
      node_version: '20.x'
      publish_command: 'npm publish'
      simulate_publish: true
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}