# .github/workflows/release.yml no repositÃ³rio consumidor
name: "2: Release & Publish"

on:
  workflow_dispatch:
  # push:
  #   branches: [ main ] # Dispara apÃ³s o merge em main

  workflow_run:
    workflows: ["1: Test & PR Automation"]
    branches: [main]
    types:
      - completed

jobs:
  release:
    name: ðŸ’¥ Gerar Release e Tag
    permissions:
      contents: write
      actions: write
      checks: write
      statuses: write

    uses: heliomarpm/ci-reusable/.github/workflows/node-release.yml@main
    with:
      branch_to_watch: "main"
      simulate_release: false
    secrets:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      # NPM_TOKEN: ${{ secrets.NPM_TOKEN }}

  publish:
    needs: release
    name: ðŸš€ Publicar no NPM
    # SÃ³ publica se o release for bem-sucedido (tag criada)
    if: success()
    uses: heliomarpm/ci-reusable/.github/workflows/node-publish.yml@main
    with:
      simulate_publish: true
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
