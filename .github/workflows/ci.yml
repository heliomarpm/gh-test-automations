name: Teste CI/CD Integrado

on:
  workflow_dispatch:
  push:
    branches: [develop, main]

jobs:
  run_ci_pipeline:
    name: Pipeline de Teste e PR
    runs-on: ubuntu-latest

    steps:    
      - name: Executar Testes com Template
        uses: heliomarpm/ci-reusable/.github/workflows/node-test.yml@main
        with:
          node_version: '20.x' 
          # test_command: 'npm test -- --coverage'

      - name: ðŸ¤– Criar/Atualizar Pull Request (develop -> main)
        # Chama o template de PR, dependendo do sucesso do teste
        uses: heliomarpm/ci-resuable/.github/workflows/node-pr.yml@main
        if: success() && github.ref == 'refs/heads/develop'
        with:
          head_branch: 'develop'
          base_branch: 'main'
        # secrets:
        #   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
