name: CI Workflow

on:
  workflow_dispatch:
  push:
    branches: [develop, main, master]

jobs:
  run_tests:
    name: ðŸ§ª Executar Testes com Template
    uses: heliomarpm/ci-reusable/.github/workflows/node-test.yml@main
    with:
      node_version: '20.x'
      skip_tests: true      
      # test_command: 'npm test -- --coverage'

  create_pr:
    # needs: run_tests
    if: success() && github.ref == 'refs/heads/develop'    
    name: ðŸ¤– Criar/Atualizar Pull Request (develop -> main)
    permissions:
      contents: write       # NecessÃ¡rio para operaÃ§Ãµes gerais de escrita (embora o PR use o API, Ã© bom para a Action)
      pull-requests: write  # ESSENCIAL: Concede permissÃ£o para criar e manipular Pull Requests.
      actions: write

    uses: heliomarpm/ci-reusable/.github/workflows/node-pr.yml@main
    secrets:
      PR_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    with:
      head_branch: 'develop'
      base_branch: 'main'             

  # release:    
  #   name: ðŸ’¥ Gerar Release e Tag
  #   uses: heliomarpm/ci-reusable/.github/workflows/node-release.yml@main
  #   with:
  #     branch_to_watch: 'main'
  #     simulate_release: false
  #   secrets:
  #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #     NPM_TOKEN: ${{ secrets.NPM_TOKEN }} 

  # publish:
  #   name: Publicar no NPM
  #   needs: release
  #   # SÃ³ publica se o release for bem-sucedido (tag criada)
  #   if: success()
  #   name: ðŸš€ Publicar no NPM
  #   uses: heliomarpm/ci-reusable/.github/workflows/node-publish.yml@main
  #   with:
  #     node_version: '20.x'
  #     publish_command: 'npm publish'
  #     simulate_publish: true
  #   secrets:
  #     NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
